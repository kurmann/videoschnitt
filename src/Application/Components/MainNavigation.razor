@namespace Kurmann.Videoschnitt.Application.Components

@inject NavigationManager Navigation
@inject Kurmann.Videoschnitt.Workflows.FinalCutProWorkflow FinalCutProWorkflow
@inject Kurmann.Videoschnitt.Workflows.HealthCheckWorkflow HealthCheckWorkflow

<nav>
    <a @onclick="ExecuteMetadataProcessing">Metadaten-Verarbeitung</a>
    <a @onclick="ExecuteHealthCheck">Status</a>
    <a href="/swagger">API-Dokumentation</a>
</nav>

@code {
    [Parameter]
    public EventCallback<string> OnLogAdded { get; set; }

    private async Task ExecuteMetadataProcessing()
    {
        var progress = new Progress<string>(async statusUpdate =>
        {
            await OnLogAdded.InvokeAsync(statusUpdate);
        });

        var result = await FinalCutProWorkflow.ExecuteAsync(progress);
        if (result.IsFailure)
        {
            Console.WriteLine($"Fehler während der Ausführung des Final Cut Pro Workflows: {result.Error}");
            await OnLogAdded.InvokeAsync(result.Error);
        }
    }

    private void ExecuteHealthCheck()
    {
        var progress = new Progress<string>(async statusUpdate =>
        {
            await OnLogAdded.InvokeAsync(statusUpdate);
        });

        var result = HealthCheckWorkflow.Execute(progress);
        if (result.IsFailure)
        {
            OnLogAdded.InvokeAsync(result.Error);
        }
    }
}